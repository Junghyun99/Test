# 요구사항 문서: 매직스플릿(주식매매알고리즘)

## 1. 대상 종목에 대해 복수 차수로 매매를 진행할 수 있어야 한다.
- **설명:** 각 종목에 대해 차수별로 매수, 매도 가격을 설정하고, 이 가격에 따라 거래가 이루어지도록 해야 한다.
- **관련 코드:** `trading_round_calculator.py`의 `setup_trading_rounds` 메서드
  - 각 차수의 매수/매도가를 설정하기 위해 초기 매수 가격에 매수, 매도 퍼센트 값을 적용해 차수별 가격을 계산한다.

## 2. 매수/매도 가격 및 퍼센트를 차수별로 다르게 설정할 수 있어야 한다.
- **설명:** 사용자 입력으로 각 차수별 매수, 매도 퍼센트를 지정할 수 있으며, 각 차수에 매수할 금액도 다르게 지정할 수 있어야 한다.
- **관련 코드:**
  - `trading_round_calculator.py`의 `__init__` 및 `setup_trading_rounds` 메서드
  - 매수, 매도 퍼센트 리스트와 각 차수별 금액 리스트를 받아 설정한다.

## 3. 거래는 더미 API를 통해 처리하고, 매수/매도 요청 시 거래번호를 받아야 한다.
- **설명:** 매수 또는 매도 요청 시 더미 API를 호출하여 거래번호를 받아야 하며, 해당 거래번호로 상태를 확인할 수 있어야 한다.
- **관련 코드:**
  - `dummy_broker_api.py`의 `buy` 및 `sell` 메서드
    - 매수/매도 요청 시 랜덤한 거래번호를 반환한다.
  - `stock_trader.py`의 `execute_trade` 메서드
    - 더미 API를 호출하여 매수 또는 매도 거래번호를 받고, 이 거래번호로 상태를 확인한다.

## 4. 거래 상태는 "완료", "펜딩", "취소" 중 하나로 처리된다.
- **설명:** 매수 또는 매도 요청 후 거래 상태가 랜덤하게 "완료", "펜딩", "취소"로 반환된다. "펜딩"일 경우 계속해서 상태를 확인해야 하며, "완료"가 되면 해당 차수의 매수/매도가 스택에 반영된다.
- **관련 코드:**
  - `dummy_broker_api.py`의 `check_transaction_status` 메서드
    - 랜덤으로 거래 상태를 반환한다.
  - `stock_trader.py`의 `execute_trade` 메서드
    - "펜딩"일 경우 계속 상태를 확인하며, "완료" 시에만 스택에 반영한다.

## 5. 종목별 스택을 사용하여 거래 상태를 기록하고 관리한다.
- **설명:** 매수 또는 매도 거래가 이루어질 때 스택을 사용하여 해당 종목의 현재 상태를 기록하며, 매수 시에는 스택에 쌓고, 매도 시에는 스택에서 제거한다.
- **관련 코드:**
  - `stock_trader.py`의 `execute_trade` 및 `stack` 속성
    - 매수 거래가 완료되면 스택에 기록되고, 매도 시에는 스택에서 제거된다.

## 6. 프로그램 재실행 시 기존 스택 상태를 복구하고 이어서 진행할 수 있어야 한다.
- **설명:** 프로그램이 종료되어도 종목별 스택 상태는 SQLite 데이터베이스에 저장되며, 재실행 시 이를 불러와서 이어서 진행할 수 있어야 한다.
- **관련 코드:**
  - `stock_stack_db.py`의 `save_stack` 및 `load_stack` 메서드
    - 종목별 스택을 SQLite 데이터베이스에 저장하고, 프로그램 재실행 시 이를 로드한다.
  - `main.py`에서 StockTrader 인스턴스 생성 시 `load_stack` 호출 및 거래 후 `save_stack` 호출

## 7. 로깅을 통해 매수/매도 내역을 파일로 저장해야 한다.
- **설명:** 각 종목에 대해 매수/매도 거래 내역을 기록하고, 이 기록은 별도의 파일 또는 콘솔로 출력할 수 있어야 한다.
- **관련 코드:**
  - `trade_logger.py`의 `log_transaction` 및 `display_trade_history` 메서드
    - 매수/매도 거래 내역을 기록하고, 기록된 내용을 출력한다.

## 8. 여러 종목을 동시에 매매할 수 있어야 한다.
- **설명:** 하나의 종목뿐 아니라 여러 종목을 병렬로 처리할 수 있어야 한다. 각 종목에 대해 별도의 `StockTrader` 인스턴스를 생성하고, 멀티스레드를 통해 병렬로 거래를 진행한다.
- **관련 코드:**
  - `main.py`에서 `threading`을 이용한 멀티스레드 실행
    - 종목별로 별도의 스레드를 만들어 각 종목이 병렬로 실행되도록 처리한다.

---

## 요구사항과 코드 매핑 요약

| 요구사항                            | 관련 코드 파일 및 메서드                                    |
|--------------------------------------|-------------------------------------------------------------|
| 1. 차수별 매매 진행                 | `trading_round_calculator.py`의 `setup_trading_rounds`       |
| 2. 매수/매도가 및 금액 차수별 설정  | `trading_round_calculator.py`의 `__init__` 및 `setup_trading_rounds` |
| 3. 더미 API 거래번호 처리           | `dummy_broker_api.py`의 `buy`, `sell`, `check_transaction_status` |
| 4. 거래 상태 확인                   | `dummy_broker_api.py`, `stock_trader.py`의 `execute_trade`   |
| 5. 스택을 이용한 거래 상태 관리      | `stock_trader.py`의 `execute_trade` 및 `stack` 속성          |
| 6. 스택 상태 저장 및 복구           | `stock_stack_db.py`의 `save_stack`, `load_stack`, `main.py`  |
| 7. 매매 내역 로깅                   | `trade_logger.py`의 `log_transaction`, `display_trade_history` |
| 8. 병렬 종목 거래 처리              | `main.py`에서 `threading`을 이용한 병렬 실행                 |

---

### 결론
이 문서는 주식 매매 알고리즘의 각 기능 요구사항과 이를 구현한 코드의 매핑을 나타냅니다. 각 기능이 코드에서 어떻게 구현되었는지를 명확하게 이해할 수 있으며, 추후 추가 요구사항이나 개선이 필요할 경우 해당 부분을 쉽게 찾을 수 있습니다. 