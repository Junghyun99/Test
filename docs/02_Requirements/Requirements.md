# Requirements Document

이 문서는 자동 주식 매매 앱의 기능 및 운영에 관한 요구사항(Functional & Non-Functional Requirements)을 명세합니다. 이 앱은 개인 투자자가 미보유 종목을 처음 매수한 후, 매직 스플릿(Magic Split) 알고리즘에 따라 자동 매매를 수행하며, 거래 기록과 포트폴리오 현황을 sqlite3 데이터베이스 기반 뷰로 관리하는 것을 목표로 합니다.

---

## 1. Functional Requirements

### 1.1 자동 매매 기능 (Automatic Trading)
- **조건 설정 및 입력 방식**:  
  - 사용자는 아직 보유하지 않은 종목을 처음 매수하면, 이후에는 미리 설정된 조건에 따라 자동 매매가 이루어집니다.
  - **매직 스플릿 알고리즘 (Magic Split Algorithm)**  
    - **차수 관리**: 동일 종목을 매수할 때마다 1차, 2차, 3차… 등으로 순차 번호를 부여하여 선입선출(FIFO) 구조를 구현합니다.
    - **N+1차 매수 조건**:  
      - **기준 정보**: 이전 N차 체결가(A)와 N차 수량(B)
      - **조건**: 현재가가 A × (1 – C)보다 낮아지면, 최대 매수액 D 내에서 N+1차 매수를 실행
    - **N차 매도 조건**:  
      - **기준 정보**: N차 체결가(A)와 N차 수량(B)
      - **조건**: 현재가가 A × (1 + E)보다 높아지면, N차의 전체 수량(B)을 매도
- **주문 실행**:  
  - 모든 거래는 **시장가 주문** 방식으로 실행됩니다.

### 1.2 거래 기록 관리 (Trade Record Management)
- **저장 방식**:  
  - 모든 거래 기록은 `sqlite3` 데이터베이스에 저장합니다.
- **기록 필드**:  
  - `id`  
  - `종목이름`  
  - `심볼`  
  - `거래번호`  
  - `국가`  
  - `차수`  
  - `체결가`  
  - `수량`  
  - `총 가격`  
  - `거래상태`  
  - `페어 id`  
  - `거래 시간`

### 1.3 잔고 및 포트폴리오 관리 (Portfolio & Balance Management)
- **업데이트 방식**:  
  - `sqlite3` 데이터베이스 기반의 뷰(View)를 통해 실시간으로 포트폴리오 현황 및 거래 중인 종목들의 모든 차수를 확인할 수 있습니다.
- **표시 내용**:  
  - 각 종목별:  
    - 매수/매도 체결 가격 대비 현재가를 기준으로 한 손실/손익률  
    - 종목, 수량, 평균가, 평가 수익률 등의 정보 (증권사 잔고 뷰와 유사한 형태)

### 1.4 실시간 업데이트 및 내역 조회 (Real-Time Updates & Historical Data)
- **실시간 업데이트**:  
  - 매수/매도 조건에 맞으면 데이터베이스를 실시간으로 수정하며, 포트폴리오 뷰는 주기적으로 DB를 읽어 최신 정보를 표시합니다.
- **내역 조회**:  
  - 날짜별, 종목별로 거래 내역을 조회할 수 있는 기능 제공

### 1.5 알고리즘 모듈 분리 (Algorithm Module Integration)
- **모듈화**:  
  - 매직 스플릿 알고리즘은 데이터베이스 접근, 증권사 API 접근, 뷰 등 다른 시스템 컴포넌트와 명확히 분리하여 구현됩니다.
- **확장성**:  
  - 단일 알고리즘 구현 외에도, 추후 여러 알고리즘을 복합적으로 연결할 수 있도록 설계합니다.

---

## 2. Non-Functional Requirements

### 2.1 보안 및 민감정보 관리 (Security & Data Protection)
- **민감 정보 암호화**:  
  - 증권사 API KEY 등 민감 정보를 암호화하여 저장합니다.
  - **권장 암호화 방식**: AES-256 등의 대칭키 암호화 기법이나, 환경 변수 및 보안 Vault 솔루션 활용
- **인증 측면**:  
  - 개인 프로젝트이므로 추가적인 사용자 인증(예: 2단계 인증 등)은 필요하지 않으나, 로컬 환경 내 데이터 무결성에 주의

### 2.2 성능 및 확장성 (Performance & Scalability)
- **거래 처리량**:  
  - 거래 조건 체크 빈도와 모니터링 종목 수에 따라 성능이 달라집니다.
  - 예를 들어, 1,000종목에 대해 100ms 이내에 조건 체크 및 체결, 데이터베이스 업데이트를 완료하는 것을 목표로 합니다.
- **병렬 처리 고려**:  
  - 종목 수가 증가(예: 10,000종목) 할 경우 병렬 처리 방안을 고민하여 지연을 최소화해야 합니다.

### 2.3 안정성 및 장애 복구 (Resilience & Fault Tolerance)
- **시스템 장애 대응**:  
  - 거래 내역은 데이터베이스에 등록되어 있으므로, 실제 거래가 완료되지 않거나 장애 발생 시 다음 주기(턴)에서 재시도할 수 있도록 설계합니다.
  - 간단한 새로고침, 재부팅 방식으로 복구가 가능하도록 합니다.
- **롤백 정책**:  
  - 거래 실행 전 장애가 발생할 경우, 안전하게 재시도할 수 있도록 설계

### 2.4 로그 기록, 오류 모니터링 및 알림 (Logging, Monitoring & Alerts)
- **로그 기록**:  
  - 각 실행 단계에서 Python의 `logging` 모듈을 사용해 텍스트 로그를 생성합니다.
- **오류 모니터링 및 알림**:  
  - 로그를 통한 오류 분석과 함께, 앱 내 팝업창 등으로 즉각적인 오류 인지를 제공합니다.

### 2.5 사용자 인터페이스 (User Interface)
- **플랫폼**:  
  - 앱은 **모바일 환경**에 최적화되어 있습니다.
- **인터페이스 구성**:  
  - 종목별 매수/매도 조건은 "N차 A% 하락시, N+1차 매수금액 B" 및 "N차 C% 상승시 전량 매도"와 같이 간결하게 표시합니다.
  - 거래 내역, 포트폴리오, 계좌 잔고 등은 직관적으로 확인할 수 있도록 디자인합니다.

### 2.6 외부 및 내부 API 연동 (External & Internal API Integration)
- **외부 연동**:  
  - 증권사 API와의 연동은 Open API 기반의 REST API와 웹소켓 기술을 활용합니다.
- **내부 통신**:  
  - 내부 모듈(데이터베이스, 증권사 API, UI 뷰 등) 간 통신은 프로젝트 아키텍처에 따라 RESTful API 또는 메시지 큐 방식 등으로 구현할 수 있습니다.

---

## 3. Testing & Validation Requirements

### 3.1 기능 테스트 (Functional Testing)
- **단위 테스트**: 각 모듈(자동 매매, 거래 기록 저장, 포트폴리오 뷰 업데이트 등)별 단위 테스트 작성
- **통합 테스트**: 모듈 간의 연동 및 데이터 흐름을 검증하는 통합 테스트

### 3.2 성능 테스트 (Performance Testing)
- 1,000종목 기준 조건 체크와 체결, 데이터베이스 업데이트가 100ms 이내에 완료되는지 시뮬레이션  
- 실시간 업데이트와 병렬 처리 효과 검증

### 3.3 보안 테스트 (Security Testing)
- API KEY 등 민감 정보 암호화 기능의 적절성 및 데이터 무결성 테스트

### 3.4 사용자 인터페이스 테스트 (UI/UX Testing)
- 모바일 환경에서의 각 뷰(거래 내역, 포트폴리오, 매매 조건 설정 등) 테스트

---

## 4. 우선순위 및 필수 기능

1. **핵심 거래 기능**: 자동 매매 조건 체크, 시장가 주문 실행, 거래 기록 저장  
2. **포트폴리오 관리**: 실시간 잔고 및 포트폴리오 뷰 제공  
3. **알고리즘 모듈화**: 매직 스플릿 알고리즘의 명확한 분리 및 모듈화  
4. **보안 및 로그 관리**: 민감 정보 암호화, 효과적인 로깅 및 오류 알림 구현  
5. **최적화 및 확장성**: 성능 목표(예: 1,000종목에 대해 100ms 내 처리) 달성을 위한 최적화 및 병렬 처리 고려

---

이 요구사항 문서는 앱의 전반적인 기능 명세와 운영 환경에 대한 기준을 설명합니다. 개발 진행 중에 추가 사항이나 변경 사항이 발생할 경우 업데이트 하도록 합니다.

